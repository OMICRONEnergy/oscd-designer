{"version":3,"file":"sld-editor.js","sourceRoot":"","sources":["../sld-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing, LitElement, svg, TemplateResult } from 'lit';\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars */\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { createRef, Ref, ref } from 'lit/directives/ref.js';\n\nimport { Edit, newEditEvent } from '@openscd/open-scd-core';\n\nimport type { Dialog } from '@material/mwc-dialog';\nimport type { SingleSelectedEvent } from '@material/mwc-list';\nimport type { TextField } from '@material/mwc-textfield';\n\nimport '@material/mwc-dialog';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item.js';\nimport '@material/mwc-textfield';\n\nimport { getReference, identity } from '@openscd/oscd-scl';\nimport {\n  bayGraphic,\n  eqRingPath,\n  equipmentGraphic,\n  movePath,\n  resizePath,\n  symbols,\n  voltageLevelGraphic,\n} from './icons.js';\nimport {\n  attributes,\n  connectionStartPoints,\n  elementPath,\n  isBusBar,\n  isEqType,\n  newConnectEvent,\n  newPlaceEvent,\n  newPlaceLabelEvent,\n  newResizeEvent,\n  newRotateEvent,\n  newStartConnectEvent,\n  newStartPlaceEvent,\n  newStartPlaceLabelEvent,\n  newStartResizeEvent,\n  Point,\n  privType,\n  removeNode,\n  removeTerminal,\n  ringedEqTypes,\n  sldNs,\n  svgNs,\n  uuid,\n  xlinkNs,\n  xmlBoolean,\n} from './util.js';\n\nconst parentTags: Partial<Record<string, string>> = {\n  ConductingEquipment: 'Bay',\n  Bay: 'VoltageLevel',\n  VoltageLevel: 'Substation',\n};\n\nconst singleTerminal = new Set([\n  'BAT',\n  'EFN',\n  'FAN',\n  'GEN',\n  'IFL',\n  'MOT',\n  'PMP',\n  'RRC',\n  'SAR',\n  'SMC',\n  'VTR',\n]);\n\ntype EditWizardDetial = { element: Element };\n\nfunction newEditWizardEvent(element: Element): CustomEvent<EditWizardDetial> {\n  return new CustomEvent<EditWizardDetial>('oscd-edit-wizard-request', {\n    bubbles: true,\n    composed: true,\n    detail: { element },\n  });\n}\n\ntype MenuItem = { handler: () => void; content: TemplateResult };\n\ntype Rect = [number, number, number, number];\n\nfunction contains([x1, y1, w1, h1]: Rect, [x2, y2, w2, h2]: Rect) {\n  return x1 <= x2 && y1 <= y2 && x1 + w1 >= x2 + w2 && y1 + h1 >= y2 + h2;\n}\n\nfunction overlaps([x1, y1, w1, h1]: Rect, [x2, y2, w2, h2]: Rect) {\n  if (x1 >= x2 + w2 || x2 >= x1 + w1) return false;\n  if (y1 >= y2 + h2 || y2 >= y1 + h1) return false;\n  return true;\n}\n\nfunction containsRect(\n  element: Element,\n  x0: number,\n  y0: number,\n  w0: number,\n  h0: number\n): boolean {\n  const {\n    pos: [x, y],\n    dim: [w, h],\n  } = attributes(element);\n  return contains([x, y, w, h], [x0, y0, w0, h0]);\n}\n\nfunction overlapsRect(\n  element: Element,\n  x0: number,\n  y0: number,\n  w0: number,\n  h0: number\n): boolean {\n  const {\n    pos: [x, y],\n    dim: [w, h],\n  } = attributes(element);\n  return overlaps([x, y, w, h], [x0, y0, w0, h0]);\n}\n\nfunction cleanPath(path: Point[]) {\n  let i = path.length - 2;\n  while (i > 0) {\n    const [x, y] = path[i];\n    const [nx, ny] = path[i + 1];\n    const [px, py] = path[i - 1];\n\n    if (\n      (x === nx && y === ny) ||\n      (x === nx && x === px) ||\n      (y === ny && y === py)\n    )\n      path.splice(i, 1);\n    i -= 1;\n  }\n}\n\nfunction isBay(element: Element) {\n  return element.tagName === 'Bay' && !isBusBar(element);\n}\n\nfunction preventDefault(e: Event) {\n  e.preventDefault();\n}\n\nfunction copy(element: Element, nsp: string): Element {\n  const clone = element.cloneNode(true) as Element;\n  const terminals = new Set<Element>(\n    Array.from(element.querySelectorAll('Terminal'))\n  );\n  const cNodes = new Set<Element>(\n    Array.from(element.querySelectorAll('ConnectivityNode'))\n  );\n  terminals.forEach(terminal => {\n    const cNode = element.ownerDocument.querySelector(\n      `ConnectivityNode[pathName=\"${terminal.getAttribute(\n        'connectivityNode'\n      )}\"]`\n    );\n    if (cNode) cNodes.add(cNode);\n  });\n  const foreignCNodes = new Set<Element>();\n  cNodes.forEach(cNode => {\n    const foreignTerminal = Array.from(\n      element.ownerDocument.querySelectorAll(\n        `Terminal[connectivityNode=\"${cNode.getAttribute('pathName')}\"]`\n      )\n    ).find(terminal => !terminals.has(terminal));\n    if (\n      foreignTerminal ||\n      (isBusBar(cNode.closest('Bay')!) &&\n        cNode.closest(element.tagName) !== element)\n    )\n      foreignCNodes.add(cNode);\n  });\n  foreignCNodes.forEach(cNode => {\n    if (cNode.closest(element.tagName) === element) {\n      if (isBusBar(cNode.closest('Bay')!))\n        clone\n          .querySelector(\n            `ConnectivityNode[pathName=\"${cNode.getAttribute('pathName')}\"]`\n          )\n          ?.closest('Bay')\n          ?.remove();\n      else\n        clone\n          .querySelector(\n            `ConnectivityNode[pathName=\"${cNode.getAttribute('pathName')}\"]`\n          )\n          ?.remove();\n    }\n    terminals.forEach(terminal => {\n      if (\n        terminal.getAttribute('connectivityNode') ===\n        cNode.getAttribute('pathName')\n      )\n        clone\n          .querySelector(`[*|uuid=\"${terminal.getAttributeNS(sldNs, 'uuid')}\"]`)\n          ?.remove();\n    });\n  });\n  Array.from(clone.querySelectorAll('Terminal')).forEach(terminal => {\n    const oldUUID = terminal.getAttributeNS(sldNs, 'uuid');\n    if (!oldUUID) return;\n    const newUUID = uuid();\n    Array.from(clone.querySelectorAll(`Vertex[*|uuid=\"${oldUUID}\"`)).forEach(\n      vertex => vertex.setAttributeNS(sldNs, `${nsp}:uuid`, newUUID)\n    );\n    terminal.setAttributeNS(sldNs, `${nsp}:uuid`, newUUID);\n  });\n  return clone;\n}\n\nfunction renderMenuFooter(element: Element) {\n  const name = element.getAttribute('name');\n  let detail: string | null | TemplateResult<1> = element.getAttribute('desc');\n  const type = element.getAttribute('type');\n  if (type) {\n    if (detail) detail = html`${type} &mdash; ${detail}`;\n    else detail = type;\n  }\n  let footerGraphic = equipmentGraphic(null);\n  if (element.tagName === 'ConductingEquipment')\n    footerGraphic = equipmentGraphic(element.getAttribute('type'));\n  else if (element.tagName === 'Bay' && isBusBar(element))\n    footerGraphic = html`<mwc-icon slot=\"graphic\">horizontal_rule</mwc-icon>`;\n  else if (element.tagName === 'Bay') footerGraphic = bayGraphic;\n  else if (element.tagName === 'VoltageLevel')\n    footerGraphic = voltageLevelGraphic;\n  return html`<mwc-list-item ?twoline=${detail} graphic=\"avatar\" noninteractive>\n    <span>${name}</span>\n    ${detail\n      ? html`<span\n          slot=\"secondary\"\n          style=\"display: inline-block; max-width: 15em; overflow: hidden; text-overflow: ellipsis;\"\n        >\n          ${detail}\n        </span>`\n      : nothing}\n    ${footerGraphic}\n  </mwc-list-item>`;\n}\n\n@customElement('sld-editor')\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars */\nexport class SLDEditor extends LitElement {\n  @property()\n  doc!: XMLDocument;\n\n  @property()\n  substation!: Element;\n\n  @property()\n  editCount = -1;\n\n  @property()\n  gridSize = 32;\n\n  @property()\n  nsp = 'esld';\n\n  @property()\n  resizing?: Element;\n\n  @property()\n  placing?: Element;\n\n  @property()\n  placingLabel?: Element;\n\n  @property()\n  connecting?: {\n    equipment: Element;\n    path: Point[];\n    terminal: 'top' | 'bottom';\n  };\n\n  @query('#resizeSubstationUI')\n  resizeSubstationUI!: Dialog;\n\n  @query('#substationWidthUI')\n  substationWidthUI!: TextField;\n\n  @query('#substationHeightUI')\n  substationHeightUI!: TextField;\n\n  @query('svg#sld')\n  sld!: SVGGraphicsElement;\n\n  @state()\n  mouseX = 0;\n\n  @state()\n  mouseY = 0;\n\n  @state()\n  mouseX2 = 0;\n\n  @state()\n  mouseY2 = 0;\n\n  @state()\n  menu?: { element: Element; top: number; left: number };\n\n  coordinatesRef: Ref<HTMLElement> = createRef();\n\n  positionCoordinates(e: MouseEvent) {\n    const coordinatesDiv = this.coordinatesRef?.value;\n    if (coordinatesDiv) {\n      coordinatesDiv.style.top = `${e.clientY}px`;\n      coordinatesDiv.style.left = `${e.clientX + 16}px`;\n    }\n  }\n\n  openMenu(element: Element, e: MouseEvent) {\n    if (\n      !this.placing &&\n      !this.resizing &&\n      !this.placingLabel &&\n      !this.connecting\n    )\n      this.menu = { element, left: e.clientX, top: e.clientY };\n    e.preventDefault();\n  }\n\n  svgCoordinates(clientX: number, clientY: number) {\n    const p = new DOMPoint(clientX, clientY);\n    const { x, y } = p.matrixTransform(this.sld.getScreenCTM()!.inverse());\n    return [x, y].map(coord => Math.max(0, coord));\n  }\n\n  canPlaceAt(element: Element, x: number, y: number, w: number, h: number) {\n    if (element.tagName === 'Substation') return true;\n\n    const overlappingSibling = Array.from(\n      this.substation.querySelectorAll(element.tagName)\n    ).find(\n      sibling =>\n        sibling !== element &&\n        overlapsRect(sibling, x, y, w, h) &&\n        !isBusBar(sibling)\n    );\n    if (overlappingSibling && !isBusBar(element)) {\n      return false;\n    }\n\n    const containingParent =\n      element.tagName === 'VoltageLevel'\n        ? containsRect(this.substation, x, y, w, h)\n        : Array.from(\n            this.substation.querySelectorAll(parentTags[element.tagName]!)\n          ).find(\n            parent => !isBusBar(parent) && containsRect(parent, x, y, w, h)\n          );\n    if (containingParent) return true;\n    return false;\n  }\n\n  canResizeTo(element: Element, w: number, h: number) {\n    const {\n      pos: [x, y],\n      dim: [oldW, oldH],\n    } = attributes(element);\n\n    if (\n      !this.canPlaceAt(element, x, y, w, h) &&\n      this.canPlaceAt(element, x, y, oldW, oldH)\n    )\n      return false;\n\n    const lostChild = Array.from(element.children).find(child => {\n      if (parentTags[child.tagName] !== element.tagName) return false;\n      const {\n        pos: [cx, cy],\n        dim: [cw, ch],\n      } = attributes(child);\n\n      return !contains([x, y, w, h], [cx, cy, cw, ch]);\n    });\n    if (lostChild) return false;\n\n    return true;\n  }\n\n  renderedLabelPosition(element: Element): Point {\n    let {\n      label: [x, y],\n    } = attributes(element);\n    if (\n      this.placing &&\n      element.closest(this.placing.tagName) === this.placing\n    ) {\n      const {\n        pos: [parentX, parentY],\n      } = attributes(this.placing);\n      x += this.mouseX - parentX;\n      y += this.mouseY - parentY;\n    }\n    if (this.placingLabel === element) {\n      x = this.mouseX2;\n      y = this.mouseY2 + 0.5;\n    }\n    return [x, y];\n  }\n\n  renderedPosition(element: Element): Point {\n    let {\n      pos: [x, y],\n    } = attributes(element);\n    if (\n      this.placing &&\n      element.closest(this.placing.tagName) === this.placing\n    ) {\n      const {\n        pos: [parentX, parentY],\n      } = attributes(this.placing);\n      x += this.mouseX - parentX;\n      y += this.mouseY - parentY;\n    }\n    return [x, y];\n  }\n\n  handleKeydown = ({ key }: KeyboardEvent) => {\n    if (key === 'Escape') this.menu = undefined;\n  };\n\n  handleClick = (e: MouseEvent) => {\n    if (\n      this.menu &&\n      !e\n        .composedPath()\n        .find(elm => 'id' in elm && elm.id === 'sld-context-menu')\n    ) {\n      e.stopImmediatePropagation();\n      this.menu = undefined;\n    }\n  };\n\n  connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('keydown', this.handleKeydown);\n    window.addEventListener('click', this.handleClick, true);\n    window.addEventListener('click', this.positionCoordinates);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    window.removeEventListener('keydown', this.handleKeydown);\n    window.removeEventListener('click', this.handleClick);\n    window.removeEventListener('click', this.positionCoordinates);\n  }\n\n  nearestOpenTerminal(equipment?: Element): 'top' | 'bottom' | undefined {\n    if (!equipment) return undefined;\n    const topTerminal = equipment.querySelector('Terminal[name=\"T1\"]');\n    const bottomTerminal = equipment.querySelector('Terminal:not([name=\"T1\"])');\n    const oneSided = singleTerminal.has(equipment.getAttribute('type')!);\n    if (topTerminal && bottomTerminal) return undefined;\n    if (oneSided && (topTerminal || bottomTerminal)) return undefined;\n    if (oneSided) return 'top';\n    if (topTerminal) return 'bottom';\n    if (bottomTerminal) return 'top';\n\n    const [mX2, mY2] = [this.mouseX2, this.mouseY2].map(n => n % 1);\n    const { rot } = attributes(equipment);\n    if (rot === 0 && mY2 === 0.5) return 'bottom';\n    if (rot === 1 && mX2 === 0) return 'bottom';\n    if (rot === 2 && mY2 === 0) return 'bottom';\n    if (rot === 3 && mX2 === 0.5) return 'bottom';\n    return 'top';\n  }\n\n  groundTerminal(equipment: Element, name: 'T1' | 'T2') {\n    const bay = equipment.closest('Bay')!;\n    const edits: Edit[] = [];\n    let grounded = bay.querySelector(\n      ':scope > ConnectivityNode[name=\"grounded\"]'\n    );\n    let pathName = grounded?.getAttribute('pathName');\n    if (!pathName) {\n      pathName = elementPath(equipment.closest('Bay')!, 'grounded');\n      grounded = this.doc.createElementNS(\n        this.doc.documentElement.namespaceURI,\n        'ConnectivityNode'\n      );\n      grounded.setAttribute('name', 'grounded');\n      grounded.setAttribute('pathName', pathName);\n      edits.push({\n        parent: bay,\n        node: grounded,\n        reference: getReference(bay, 'ConnectivityNode'),\n      });\n    }\n    const terminal = this.doc.createElementNS(\n      this.doc.documentElement.namespaceURI,\n      'Terminal'\n    );\n    terminal.setAttribute('name', name);\n    terminal.setAttribute('cNodeName', 'grounded');\n    const sName = equipment.closest('Substation')!.getAttribute('name');\n    if (sName) terminal.setAttribute('substationName', sName);\n    const vlName = equipment.closest('VoltageLevel')!.getAttribute('name');\n    if (vlName) terminal.setAttribute('voltageLevelName', vlName);\n    const bName = equipment.closest('Bay')!.getAttribute('name');\n    if (bName) terminal.setAttribute('bayName', bName);\n    terminal.setAttribute('connectivityNode', pathName);\n    edits.push({\n      parent: equipment,\n      node: terminal,\n      reference: getReference(equipment, 'Terminal'),\n    });\n    this.dispatchEvent(newEditEvent(edits));\n  }\n\n  flipElement(element: Element) {\n    const { flip } = attributes(element);\n    this.dispatchEvent(\n      newEditEvent({\n        element,\n        attributes: {\n          [`${this.nsp}:flip`]: {\n            namespaceURI: sldNs,\n            value: flip ? null : 'true',\n          },\n        },\n      })\n    );\n  }\n\n  equipmentMenuItems(equipment: Element) {\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Mirror</span>\n          <mwc-icon slot=\"graphic\">flip</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.flipElement(equipment),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Rotate</span>\n          <mwc-icon slot=\"graphic\">rotate_90_degrees_cw</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(newRotateEvent(equipment));\n        },\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Copy</span>\n          <mwc-icon slot=\"graphic\">copy_all</mwc-icon>\n        </mwc-list-item>`,\n        handler: () =>\n          this.dispatchEvent(newStartPlaceEvent(copy(equipment, this.nsp))),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            height=\"24\"\n            width=\"24\"\n            slot=\"graphic\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${movePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceEvent(equipment)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move Label</span>\n          <mwc-icon slot=\"graphic\">text_rotation_none</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceLabelEvent(equipment)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(equipment)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Delete</span>\n          <mwc-icon slot=\"graphic\">delete</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          const edits: Edit[] = [];\n          Array.from(equipment.querySelectorAll('Terminal')).forEach(terminal =>\n            edits.push(...removeTerminal(terminal))\n          );\n          edits.push({ node: equipment });\n          this.dispatchEvent(newEditEvent(edits));\n        },\n      },\n    ];\n\n    const { rot } = attributes(equipment);\n    const icons = {\n      connect: ['north', 'east', 'south', 'west'],\n      ground: ['expand_less', 'chevron_right', 'expand_more', 'chevron_left'],\n      disconnect: [\n        'arrow_drop_up',\n        'arrow_right',\n        'arrow_drop_down',\n        'arrow_left',\n      ],\n    };\n    const texts = {\n      connect: [\n        'Connect top',\n        'Connect right',\n        'Connect bottom',\n        'Connect left',\n      ],\n      ground: ['Ground top', 'Ground right', 'Ground bottom', 'Ground left'],\n      disconnect: [\n        'Detach top',\n        'Detach right',\n        'Detach bottom',\n        'Detach left',\n      ],\n    };\n    const icon = (kind: 'connect' | 'ground' | 'disconnect', top: boolean) =>\n      icons[kind][top ? rot % 4 : (rot + 2) % 4];\n    const text = (kind: 'connect' | 'ground' | 'disconnect', top: boolean) =>\n      texts[kind][top ? rot % 4 : (rot + 2) % 4];\n    const item = (kind: 'connect' | 'ground' | 'disconnect', top: boolean) =>\n      html`<mwc-list-item graphic=\"icon\">\n        <span>${text(kind, top)}</span>\n        <mwc-icon slot=\"graphic\">${icon(kind, top)}</mwc-icon>\n      </mwc-list-item>`;\n\n    const topTerminal = equipment.querySelector('Terminal[name=\"T1\"]');\n    const bottomTerminal = equipment.querySelector('Terminal:not([name=\"T1\"])');\n\n    if (!singleTerminal.has(equipment.getAttribute('type')!)) {\n      if (bottomTerminal)\n        items.unshift({\n          handler: () =>\n            this.dispatchEvent(newEditEvent(removeTerminal(bottomTerminal))),\n          content: item('disconnect', false),\n        });\n      else\n        items.unshift(\n          {\n            handler: () =>\n              this.dispatchEvent(\n                newStartConnectEvent({\n                  equipment,\n                  terminal: 'bottom',\n                })\n              ),\n            content: item('connect', false),\n          },\n          {\n            handler: () => this.groundTerminal(equipment, 'T2'),\n            content: item('ground', false),\n          }\n        );\n    }\n    if (topTerminal)\n      items.unshift({\n        handler: () =>\n          this.dispatchEvent(newEditEvent(removeTerminal(topTerminal))),\n        content: item('disconnect', true),\n      });\n    else\n      items.unshift(\n        {\n          handler: () =>\n            this.dispatchEvent(\n              newStartConnectEvent({ equipment, terminal: 'top' })\n            ),\n          content: item('connect', true),\n        },\n        {\n          handler: () => this.groundTerminal(equipment, 'T1'),\n          content: item('ground', true),\n        }\n      );\n    return items;\n  }\n\n  busBarMenuItems(busBar: Element) {\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Resize</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            slot=\"graphic\"\n            width=\"24\"\n            height=\"24\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${resizePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartResizeEvent(busBar)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            height=\"24\"\n            width=\"24\"\n            slot=\"graphic\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${movePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceEvent(busBar)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move Label</span>\n          <mwc-icon slot=\"graphic\">text_rotation_none</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceLabelEvent(busBar)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(busBar)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Delete</span>\n          <mwc-icon slot=\"graphic\">delete</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          const node = busBar.querySelector('ConnectivityNode')!;\n          this.dispatchEvent(\n            newEditEvent([...removeNode(node), { node: busBar }])\n          );\n        },\n      },\n    ];\n    return items;\n  }\n\n  containerMenuItems(bayOrVL: Element) {\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Resize</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            slot=\"graphic\"\n            width=\"24\"\n            height=\"24\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${resizePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartResizeEvent(bayOrVL)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Copy</span>\n          <mwc-icon slot=\"graphic\">copy_all</mwc-icon>\n        </mwc-list-item>`,\n        handler: () =>\n          this.dispatchEvent(newStartPlaceEvent(copy(bayOrVL, this.nsp))),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            height=\"24\"\n            width=\"24\"\n            slot=\"graphic\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${movePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceEvent(bayOrVL)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move Label</span>\n          <mwc-icon slot=\"graphic\">text_rotation_none</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceLabelEvent(bayOrVL)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(bayOrVL)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Delete</span>\n          <mwc-icon slot=\"graphic\">delete</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          const edits: Edit[] = [];\n          Array.from(bayOrVL.getElementsByTagName('ConnectivityNode')).forEach(\n            cNode => {\n              if (\n                Array.from(\n                  this.doc.querySelectorAll(\n                    `Terminal[connectivityNode=\"${cNode.getAttribute(\n                      'pathName'\n                    )}\"]`\n                  )\n                ).find(\n                  terminal => terminal.closest(bayOrVL.tagName) !== bayOrVL\n                )\n              )\n                edits.push(...removeNode(cNode));\n            }\n          );\n          Array.from(bayOrVL.getElementsByTagName('Terminal')).forEach(\n            terminal => {\n              const cNode = this.doc.querySelector(\n                `ConnectivityNode[pathName=\"${terminal.getAttribute(\n                  'connectivityNode'\n                )}\"]`\n              );\n              if (cNode && cNode.closest(bayOrVL.tagName) !== bayOrVL)\n                edits.push(...removeNode(cNode));\n            }\n          );\n          edits.push({ node: bayOrVL });\n          this.dispatchEvent(newEditEvent(edits));\n        },\n      },\n    ];\n    return items;\n  }\n\n  renderMenu() {\n    if (!this.menu) return html``;\n    const { element } = this.menu;\n\n    let items: MenuItem[] = [];\n    if (element.tagName === 'ConductingEquipment')\n      items = this.equipmentMenuItems(element);\n    else if (element.tagName === 'Bay' && isBusBar(element))\n      items = this.busBarMenuItems(element);\n    else if (element.tagName === 'Bay' || element.tagName === 'VoltageLevel')\n      items = this.containerMenuItems(element);\n\n    return html`\n      <menu\n        id=\"sld-context-menu\"\n        style=\"position: fixed; top: ${this.menu.top}px; left: ${this.menu\n          .left}px; background: var(--oscd-base3, white); margin: 0px; padding: 0px; box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23); --mdc-list-vertical-padding: 0px; overflow-y: auto;\"\n        ${ref(async (menu?: Element) => {\n          if (!(menu instanceof HTMLElement)) return;\n          const nav = (\n            this.parentElement!.getRootNode() as ShadowRoot\n          ).querySelector('nav')!;\n          const navHeight = nav.offsetHeight + 8;\n          await this.updateComplete;\n          const { bottom, right } = menu.getBoundingClientRect();\n          if (bottom > window.innerHeight - navHeight) {\n            menu.style.removeProperty('top');\n            // eslint-disable-next-line no-param-reassign\n            menu.style.bottom = `${navHeight}px`;\n            // eslint-disable-next-line no-param-reassign\n            menu.style.maxHeight = `calc(100vh - ${navHeight + 68}px)`;\n          }\n          if (right > window.innerWidth) {\n            menu.style.removeProperty('left');\n            // eslint-disable-next-line no-param-reassign\n            menu.style.right = '0px';\n          }\n        })}\n      >\n        <mwc-list\n          @selected=${({ detail: { index } }: SingleSelectedEvent) => {\n            items[index]?.handler();\n            this.menu = undefined;\n          }}\n        >\n          ${items.map(i => i.content)}\n          <li divider role=\"separator\"></li>\n          ${renderMenuFooter(element)}\n        </mwc-list>\n      </menu>\n    `;\n  }\n\n  render() {\n    const {\n      dim: [w, h],\n    } = attributes(this.substation);\n\n    const placingTarget =\n      this.placing?.tagName === 'VoltageLevel'\n        ? svg`<rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />`\n        : nothing;\n\n    const placingLabelTarget = this.placingLabel\n      ? svg`<rect width=\"100%\" height=\"100%\" fill=\"url(#halfgrid)\"\n      @click=${() => {\n        const element = this.placingLabel!;\n        const [x, y] = this.renderedLabelPosition(element);\n        this.dispatchEvent(newPlaceLabelEvent({ element, x, y }));\n      }}\n      />`\n      : nothing;\n\n    let placingElement = svg``;\n    if (this.placing) {\n      if (this.placing.tagName === 'VoltageLevel' || isBay(this.placing))\n        placingElement = svg`${this.renderContainer(this.placing, true)}`;\n      else if (this.placing.tagName === 'ConductingEquipment')\n        placingElement = this.renderEquipment(this.placing, { preview: true });\n      else if (isBusBar(this.placing))\n        placingElement = this.renderBusBar(this.placing);\n    }\n\n    let coordinates = html``;\n    let invalid = false;\n    let hidden = true;\n    if (this.placing) {\n      const {\n        dim: [w0, h0],\n      } = attributes(this.placing);\n      hidden = false;\n      invalid = !this.canPlaceAt(\n        this.placing,\n        this.mouseX,\n        this.mouseY,\n        w0,\n        h0\n      );\n      coordinates = html`${this.mouseX},${this.mouseY}`;\n    }\n\n    if (this.resizing && !isBusBar(this.resizing)) {\n      const {\n        pos: [x, y],\n      } = attributes(this.resizing);\n      const newW = Math.max(1, this.mouseX - x + 1);\n      const newH = Math.max(1, this.mouseY - y + 1);\n      hidden = false;\n      invalid = !this.canResizeTo(this.resizing, newW, newH);\n      coordinates = html`${newW}&times;${newH}`;\n    }\n    const coordinateTooltip = html`<div\n      ${ref(this.coordinatesRef)}\n      class=\"${classMap({ coordinates: true, invalid, hidden })}\"\n    >\n      (${coordinates})\n    </div>`;\n\n    const connectionPreview = [];\n    if (this.connecting?.equipment.closest('Substation') === this.substation) {\n      const { equipment, path, terminal } = this.connecting;\n      let i = 0;\n      while (i < path.length - 2) {\n        const [x1, y1] = path[i];\n        const [x2, y2] = path[i + 1];\n        connectionPreview.push(\n          svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                stroke-linecap=\"square\" stroke=\"black\" />`\n        );\n        i += 1;\n      }\n\n      const [[x1, y1], [oldX2, oldY2]] = path.slice(-2);\n      const vertical = x1 === oldX2;\n\n      let x3 = this.mouseX + 0.5;\n      let y3 = this.mouseY + 0.5;\n      let [x4, y4] = [x3, y3];\n\n      const targetEq = Array.from(\n        this.substation.querySelectorAll('ConductingEquipment')\n      )\n        .filter(eq => eq !== equipment)\n        .find(eq => {\n          const {\n            pos: [x, y],\n          } = attributes(eq);\n          return x === this.mouseX && y === this.mouseY;\n        });\n\n      const toTerminal = this.nearestOpenTerminal(targetEq);\n\n      if (targetEq && toTerminal) {\n        const { far, close } = connectionStartPoints(targetEq)[toTerminal];\n        [x3, y3] = far;\n        [x4, y4] = close;\n      }\n\n      const x2 = vertical ? oldX2 : x3;\n      const y2 = vertical ? y3 : oldY2;\n\n      connectionPreview.push(\n        svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                stroke-linecap=\"square\" stroke=\"black\" />`,\n        svg`<line x1=\"${x2}\" y1=\"${y2}\" x2=\"${x3}\" y2=\"${y3}\"\n                stroke-linecap=\"square\" stroke=\"black\" />`,\n        svg`<line x1=\"${x3}\" y1=\"${y3}\" x2=\"${x4}\" y2=\"${y4}\"\n                stroke-linecap=\"square\" stroke=\"black\" />`\n      );\n      connectionPreview.push(\n        svg`<rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\"\n      @click=${() => {\n        path[path.length - 1] = [x2, y2];\n        path.push([x3, y3]);\n        path.push([x4, y4]);\n        cleanPath(path);\n        this.requestUpdate();\n        if (targetEq && toTerminal)\n          this.dispatchEvent(\n            newConnectEvent({\n              equipment,\n              terminal,\n              path,\n              connectTo: targetEq,\n              toTerminal,\n            })\n          );\n      }} />`\n      );\n    }\n\n    const menu = this.renderMenu();\n\n    return html`<section>\n      <h2>\n        ${this.substation.getAttribute('name')}\n        <mwc-icon-button\n          label=\"Resize Substation\"\n          @click=${() => this.resizeSubstationUI.show()}\n        >\n          <svg\n            xmlns=\"${svgNs}\"\n            width=\"24\"\n            height=\"24\"\n            viewBox=\"0 96 960 960\"\n            opacity=\"0.83\"\n          >\n            ${resizePath}\n          </svg>\n        </mwc-icon-button>\n      </h2>\n      <svg\n        xmlns=\"${svgNs}\"\n        xmlns:xlink=\"${xlinkNs}\"\n        id=\"sld\"\n        viewBox=\"0 0 ${w} ${h}\"\n        width=\"${w * this.gridSize}\"\n        height=\"${h * this.gridSize}\"\n        stroke-width=\"0.06\"\n        fill=\"none\"\n        @mousemove=${(e: MouseEvent) => {\n          const [x, y] = this.svgCoordinates(e.clientX, e.clientY);\n          this.mouseX = Math.floor(x);\n          this.mouseY = Math.floor(y);\n          this.mouseX2 = Math.floor(x * 2) / 2;\n          this.mouseY2 = Math.floor(y * 2) / 2;\n          this.positionCoordinates(e);\n        }}\n      >\n        <style>\n          .handle {\n            visibility: hidden;\n          }\n          :focus {\n            outline: none;\n          }\n          :focus > .handle,\n          :focus-within > .handle {\n            opacity: 0.2;\n            visibility: visible;\n          }\n          .handle:hover,\n          .handle:focus {\n            visibility: visible;\n            opacity: 1;\n          }\n          g.voltagelevel > rect,\n          g.bay > rect {\n            shape-rendering: crispEdges;\n          }\n          svg:not(:hover) .preview {\n            visibility: hidden;\n          }\n          .preview {\n            opacity: 0.83;\n          }\n        </style>\n        ${symbols}\n        <rect width=\"100%\" height=\"100%\" fill=\"white\" />\n        ${placingTarget}\n        ${Array.from(this.substation.children)\n          .filter(child => child.tagName === 'VoltageLevel')\n          .map(vl => svg`${this.renderContainer(vl)}`)}\n        ${connectionPreview}\n        ${this.connecting?.equipment.closest('Substation') === this.substation\n          ? Array.from(\n              this.substation.querySelectorAll('ConductingEquipment')\n            ).map(eq => this.renderEquipment(eq, { connect: true }))\n          : nothing}\n        ${Array.from(this.substation.querySelectorAll('ConnectivityNode'))\n          .filter(\n            node =>\n              node.getAttribute('name') !== 'grounded' &&\n              !(\n                this.placing &&\n                node.closest(this.placing.tagName) === this.placing\n              ) &&\n              !isBusBar(node.parentElement!)\n          )\n          .map(cNode => this.renderConnectivityNode(cNode))}\n        ${Array.from(this.substation.querySelectorAll('ConnectivityNode'))\n          .filter(\n            node =>\n              node.getAttribute('name') !== 'grounded' &&\n              !(\n                this.placing &&\n                node.closest(this.placing.tagName) === this.placing\n              ) &&\n              isBusBar(node.parentElement!)\n          )\n          .map(cNode => this.renderConnectivityNode(cNode))}\n        ${Array.from(\n          this.substation.querySelectorAll(\n            'VoltageLevel, Bay, ConductingEquipment'\n          )\n        )\n          .filter(\n            e =>\n              !this.placing || e.closest(this.placing.tagName) !== this.placing\n          )\n          .map(element => this.renderLabel(element))}\n        ${placingLabelTarget} ${placingElement}\n      </svg>\n      ${menu} ${coordinateTooltip}\n      <mwc-dialog\n        id=\"resizeSubstationUI\"\n        heading=\"Resize ${this.substation.getAttribute('name')}\"\n      >\n        <div style=\"display: flex; flex-direction: column; gap: 12px;\">\n          <mwc-textfield\n            id=\"substationWidthUI\"\n            type=\"number\"\n            min=\"1\"\n            step=\"1\"\n            label=\"Width\"\n            value=\"${w}\"\n            dialogInitialFocus\n            autoValidate\n            .validityTransform=${(value: string, validity: ValidityState) => {\n              const {\n                dim: [_w, oldH],\n              } = attributes(this.substation);\n              if (\n                validity.valid &&\n                !this.canResizeTo(this.substation, parseInt(value, 10), oldH)\n              ) {\n                return { valid: false, rangeUnderflow: true };\n              }\n              return {};\n            }}\n          ></mwc-textfield>\n          <mwc-textfield\n            id=\"substationHeightUI\"\n            type=\"number\"\n            min=\"1\"\n            step=\"1\"\n            label=\"Height\"\n            value=\"${h}\"\n            autoValidate\n            .validityTransform=${(value: string, validity: ValidityState) => {\n              const {\n                dim: [oldW, _h],\n              } = attributes(this.substation);\n              if (\n                validity.valid &&\n                !this.canResizeTo(this.substation, oldW, parseInt(value, 10))\n              ) {\n                return { valid: false, rangeUnderflow: true };\n              }\n              return {};\n            }}\n          ></mwc-textfield>\n        </div>\n        <mwc-button\n          slot=\"primaryAction\"\n          @click=${() => {\n            const valid = Array.from(\n              this.resizeSubstationUI.querySelectorAll('mwc-textfield')\n            ).every(textField => textField.checkValidity());\n            if (!valid) return;\n            const {\n              dim: [oldW, oldH],\n            } = attributes(this.substation);\n            const [newW, newH] = [\n              this.substationWidthUI,\n              this.substationHeightUI,\n            ].map(ui => parseInt(ui.value ?? '1', 10).toString());\n            this.resizeSubstationUI.close();\n            if (newW === oldW.toString() && newH === oldH.toString()) return;\n            this.dispatchEvent(\n              newEditEvent({\n                element: this.substation,\n                attributes: {\n                  [`${this.nsp}:w`]: { namespaceURI: sldNs, value: newW },\n                  [`${this.nsp}:h`]: { namespaceURI: sldNs, value: newH },\n                },\n              })\n            );\n          }}\n          >resize</mwc-button\n        >\n        <mwc-button dialogAction=\"close\" slot=\"secondaryAction\"\n          >cancel</mwc-button\n        >\n      </mwc-dialog>\n    </section>`;\n  }\n\n  renderLabel(element: Element) {\n    const [x, y] = this.renderedLabelPosition(element);\n    const name = element.getAttribute('name');\n    const fontSize = element.tagName === 'ConductingEquipment' ? 0.45 : 0.6;\n    let events = 'none';\n    let handleClick: (() => void) | symbol = nothing;\n    if (\n      !this.placing &&\n      !this.resizing &&\n      !this.connecting &&\n      !this.placingLabel\n    ) {\n      events = 'all';\n      handleClick = () => this.dispatchEvent(newStartPlaceLabelEvent(element));\n    }\n    const id =\n      element.closest('Substation') === this.substation\n        ? identity(element)\n        : nothing;\n    return svg`<g class=\"label\" id=\"label:${id}\">\n        <text x=\"${x + 0.1}\" y=\"${y - 0.2}\"\n          @mousedown=${preventDefault}\n          @auxclick=${(e: MouseEvent) => {\n            if (e.button === 1) {\n              // middle mouse button\n              this.dispatchEvent(newEditWizardEvent(element));\n              e.preventDefault();\n            }\n          }}\n          @click=${handleClick}\n          @contextmenu=${(e: MouseEvent) => this.openMenu(element, e)}\n          pointer-events=\"${events}\" fill=\"#000000\" fill-opacity=\"0.83\"\n          style=\"font: ${fontSize}px sans-serif; cursor: default;\">\n          ${name}\n        </text>\n      </g>`;\n  }\n\n  renderContainer(bayOrVL: Element, preview = false): TemplateResult<2> {\n    const isVL = bayOrVL.tagName === 'VoltageLevel';\n    if (this.placing === bayOrVL && !preview) return svg``;\n\n    const [x, y] = this.renderedPosition(bayOrVL);\n    let {\n      dim: [w, h],\n    } = attributes(bayOrVL);\n    let handleClick: ((e: MouseEvent) => void) | undefined;\n    let invalid = false;\n\n    if (this.resizing === bayOrVL) {\n      w = Math.max(1, this.mouseX - x + 1);\n      h = Math.max(1, this.mouseY - y + 1);\n      if (this.canResizeTo(bayOrVL, w, h))\n        handleClick = () => {\n          this.dispatchEvent(\n            newResizeEvent({\n              w,\n              h,\n              element: bayOrVL,\n            })\n          );\n        };\n      else invalid = true;\n    }\n\n    if (this.placing === bayOrVL) {\n      let parent: Element | undefined;\n      if (isVL) parent = this.substation;\n      else\n        parent = Array.from(\n          this.substation.querySelectorAll(':root > Substation > VoltageLevel')\n        ).find(vl => containsRect(vl, x, y, w, h));\n      if (parent && this.canPlaceAt(bayOrVL, x, y, w, h))\n        handleClick = () => {\n          this.dispatchEvent(\n            newPlaceEvent({\n              x,\n              y,\n              element: bayOrVL,\n              parent: parent!,\n            })\n          );\n        };\n      else invalid = true;\n    }\n\n    let moveHandle = svg``;\n    let resizeHandle = svg``;\n    let placingTarget = svg``;\n    let resizingTarget = svg``;\n    if (\n      (isVL && this.placing?.tagName === 'Bay') ||\n      (!isVL && this.placing?.tagName === 'ConductingEquipment')\n    )\n      placingTarget = svg`<rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\"\n        @click=${handleClick || nothing} fill=\"url(#grid)\" />`;\n\n    if (\n      this.resizing === bayOrVL ||\n      (this.resizing?.parentElement === bayOrVL && isBusBar(this.resizing))\n    )\n      resizingTarget = svg`<rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\"\n        @click=${handleClick || nothing} fill=\"url(#grid)\" />`;\n\n    if (\n      !this.placing &&\n      !this.resizing &&\n      !this.connecting &&\n      !this.placingLabel\n    ) {\n      moveHandle = svg`<svg class=\"handle\" xmlns=\"${svgNs}\" height=\"1\" width=\"1\"\n          fill=\"black\" opacity=\"0.83\" viewBox=\"0 96 960 960\" \n          @click=${(e: MouseEvent) =>\n            this.dispatchEvent(\n              newStartPlaceEvent(e.shiftKey ? copy(bayOrVL, this.nsp) : bayOrVL)\n            )}\n          x=\"${x}\" y=\"${y}\">\n        <rect fill=\"white\" x=\"28.8\" y=\"124.8\" width=\"902.4\" height=\"902.4\" />\n        ${movePath}\n      </svg>`;\n      resizeHandle = svg`<svg class=\"handle\" xmlns=\"${svgNs}\" height=\"1\" width=\"1\"\n          fill=\"black\" opacity=\"0.83\" viewBox=\"0 96 960 960\" \n          @click=${() => this.dispatchEvent(newStartResizeEvent(bayOrVL))}\n          x=\"${w + x - 1}\" y=\"${h + y - 1}\">\n        <rect fill=\"white\" x=\"28.8\" y=\"124.8\" width=\"902.4\" height=\"902.4\" />\n        ${resizePath}\n      </svg>`;\n    }\n\n    return svg`<g id=\"${\n      bayOrVL.closest('Substation') === this.substation\n        ? identity(bayOrVL)\n        : nothing\n    }\" class=${classMap({\n      voltagelevel: isVL,\n      bay: !isVL,\n      preview,\n    })} tabindex=\"0\" pointer-events=\"all\" style=\"outline: none;\">\n      <rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\"\n        @contextmenu=${(e: MouseEvent) => this.openMenu(bayOrVL, e)}\n        @click=${handleClick || nothing}\n        fill=\"white\" stroke-dasharray=\"${isVL ? nothing : '0.18'}\"\n        stroke=\"${\n          // eslint-disable-next-line no-nested-ternary\n          invalid ? '#BB1326' : isVL ? '#F5E214' : '#12579B'\n        }\" />\n      ${moveHandle}\n      ${placingTarget}\n      ${Array.from(bayOrVL.children)\n        .filter(isBay)\n        .map(bay => this.renderContainer(bay))}\n      ${Array.from(bayOrVL.children)\n        .filter(child => child.tagName === 'ConductingEquipment')\n        .map(equipment => this.renderEquipment(equipment))}\n      ${\n        preview\n          ? Array.from(bayOrVL.querySelectorAll('ConnectivityNode'))\n              .filter(child => child.getAttribute('name') !== 'grounded')\n              .map(cNode => this.renderConnectivityNode(cNode))\n          : nothing\n      }\n      ${\n        preview\n          ? Array.from(bayOrVL.querySelectorAll('Bay, ConductingEquipment'))\n              .concat(bayOrVL)\n              .map(element => this.renderLabel(element))\n          : nothing\n      }\n      ${resizeHandle}\n      ${resizingTarget}\n    </g>`;\n  }\n\n  renderEquipment(\n    equipment: Element,\n    { preview = false, connect = false } = {}\n  ) {\n    if (this.placing === equipment && !preview) return svg``;\n    if (\n      this.connecting?.equipment.closest('Substation') === this.substation &&\n      !connect\n    )\n      return svg``;\n\n    const [x, y] = this.renderedPosition(equipment);\n    const { flip, rot } = attributes(equipment);\n    const deg = 90 * rot;\n\n    const eqType = equipment.getAttribute('type')!;\n    const ringed = ringedEqTypes.has(eqType);\n    const symbol = isEqType(eqType) ? eqType : 'ConductingEquipment';\n    const icon = ringed\n      ? svg`<svg\n    viewBox=\"0 0 25 25\"\n    width=\"1\"\n    height=\"1\"\n  >\n    ${eqRingPath}\n  </svg>`\n      : svg`<use href=\"#${symbol}\" xlink:href=\"#${symbol}\"\n              pointer-events=\"none\" />`;\n\n    let handleClick = (e: MouseEvent) => {\n      let placing = equipment;\n      if (e.shiftKey) placing = copy(equipment, this.nsp);\n      this.dispatchEvent(newStartPlaceEvent(placing));\n    };\n\n    if (this.placing === equipment) {\n      const parent = Array.from(\n        this.substation.querySelectorAll(\n          ':root > Substation > VoltageLevel > Bay'\n        )\n      ).find(bay => !isBusBar(bay) && containsRect(bay, x, y, 1, 1));\n      if (parent && this.canPlaceAt(equipment, x, y, 1, 1))\n        handleClick = () => {\n          this.dispatchEvent(\n            newPlaceEvent({\n              x,\n              y,\n              element: equipment,\n              parent,\n            })\n          );\n        };\n    }\n\n    const terminals = Array.from(equipment.children).filter(\n      c => c.tagName === 'Terminal'\n    );\n    const topTerminal = terminals.find(t => t.getAttribute('name') === 'T1');\n    const bottomTerminal = terminals.find(t => t.getAttribute('name') !== 'T1');\n\n    const topConnector =\n      topTerminal || this.placing || this.resizing || this.connecting\n        ? nothing\n        : svg`<circle cx=\"0.5\" cy=\"0\" r=\"0.2\" opacity=\"0.4\"\n      fill=\"#BB1326\" stroke=\"#F5E214\"\n    @click=${() =>\n      this.dispatchEvent(newStartConnectEvent({ equipment, terminal: 'top' }))}\n    @contextmenu=${(e: MouseEvent) => {\n      e.preventDefault();\n      this.groundTerminal(equipment, 'T1');\n    }}\n      />`;\n\n    const topIndicator =\n      !this.connecting ||\n      this.connecting.equipment === equipment ||\n      (this.connecting &&\n        this.mouseX === x &&\n        this.mouseY === y &&\n        this.nearestOpenTerminal(equipment) === 'top') ||\n      topTerminal\n        ? nothing\n        : svg`<polygon points=\"0.3,0 0.7,0 0.5,0.4\" \n                fill=\"#12579B\" opacity=\"0.4\" />`;\n\n    const topGrounded =\n      topTerminal?.getAttribute('cNodeName') === 'grounded'\n        ? svg`<line x1=\"0.5\" y1=\"-0.1\" x2=\"0.5\" y2=\"0\" stroke=\"black\" stroke-width=\"0.06\" marker-start=\"url(#grounded)\" />`\n        : nothing;\n\n    const bottomConnector =\n      bottomTerminal ||\n      this.placing ||\n      this.resizing ||\n      this.connecting ||\n      singleTerminal.has(eqType)\n        ? nothing\n        : svg`<circle cx=\"0.5\" cy=\"1\" r=\"0.2\" opacity=\"0.4\"\n      fill=\"#BB1326\" stroke=\"#F5E214\"\n    @click=${() =>\n      this.dispatchEvent(\n        newStartConnectEvent({ equipment, terminal: 'bottom' })\n      )}\n    @contextmenu=${(e: MouseEvent) => {\n      e.preventDefault();\n      this.groundTerminal(equipment, 'T2');\n    }}\n      />`;\n\n    const bottomIndicator =\n      !this.connecting ||\n      this.connecting.equipment === equipment ||\n      (this.connecting &&\n        this.mouseX === x &&\n        this.mouseY === y &&\n        this.nearestOpenTerminal(equipment) === 'bottom') ||\n      bottomTerminal ||\n      singleTerminal.has(eqType)\n        ? nothing\n        : svg`<polygon points=\"0.3,1 0.7,1 0.5,0.6\" \n                fill=\"#12579B\" opacity=\"0.4\" />`;\n\n    const bottomGrounded =\n      bottomTerminal?.getAttribute('cNodeName') === 'grounded'\n        ? svg`<line x1=\"0.5\" y1=\"1.1\" x2=\"0.5\" y2=\"1\" stroke=\"black\"\n                stroke-width=\"0.06\" marker-start=\"url(#grounded)\" />`\n        : nothing;\n\n    return svg`<g class=\"${classMap({\n      equipment: true,\n      preview: this.placing === equipment,\n    })}\"\n    id=\"${\n      equipment.closest('Substation') === this.substation\n        ? identity(equipment)\n        : nothing\n    }\"\n    transform=\"translate(${x} ${y}) rotate(${deg} 0.5 0.5)${\n      flip ? ' scale(-1,1) translate(-1 0)' : ''\n    }\">\n      <title>${equipment.getAttribute('name')}</title>\n      ${icon}\n      ${\n        ringed\n          ? svg`<use transform=\"rotate(${-deg} 0.5 0.5)\" pointer-events=\"none\"\n                  href=\"#${symbol}\" xlink:href=\"#${symbol}\" />`\n          : nothing\n      }\n      <rect width=\"1\" height=\"1\" fill=\"none\" pointer-events=\"${\n        connect ? 'none' : 'all'\n      }\"\n        @mousedown=${preventDefault}\n        @click=${handleClick}\n        @auxclick=${(e: MouseEvent) => {\n          if (e.button === 1) {\n            // middle mouse button\n            this.dispatchEvent(newRotateEvent(equipment));\n            e.preventDefault();\n          }\n        }}\n        @contextmenu=${(e: MouseEvent) => this.openMenu(equipment, e)}\n      />\n      ${topConnector}\n      ${topIndicator}\n      ${topGrounded}\n      ${bottomConnector}\n      ${bottomIndicator}\n      ${bottomGrounded}\n    </g>\n    <g class=\"preview\">${preview ? this.renderLabel(equipment) : nothing}</g>`;\n  }\n\n  renderBusBar(busBar: Element) {\n    const [x, y] = this.renderedPosition(busBar);\n    const {\n      dim: [w, h],\n    } = attributes(busBar);\n    let placingTarget = svg``;\n    placingTarget = svg`<rect x=\"${x}\" y=\"${y}\" width=\"1\" height=\"1\"\n          pointer-events=\"all\" fill=\"none\" \n          @click=${() => {\n            const parent = Array.from(\n              this.substation.querySelectorAll(\n                ':root > Substation > VoltageLevel'\n              )\n            ).find(vl => containsRect(vl, x, y, w, h));\n            if (parent)\n              this.dispatchEvent(\n                newPlaceEvent({\n                  x,\n                  y,\n                  element: busBar,\n                  parent: parent!,\n                })\n              );\n          }}\n        />`;\n    return svg`<g class=\"bus preview\" id=\"${\n      busBar.closest('Substation') === this.substation\n        ? identity(busBar)\n        : nothing\n    }\">\n      <title>${busBar.getAttribute('name')}</title>\n      ${this.renderLabel(busBar)}\n      ${this.renderConnectivityNode(busBar.querySelector('ConnectivityNode')!)}\n      ${placingTarget}\n    </g>`;\n  }\n\n  renderConnectivityNode(cNode: Element) {\n    const priv = cNode.querySelector(`Private[type=\"${privType}\"]`);\n    if (!priv) return nothing;\n    const circles = [] as TemplateResult<2>[];\n    const intersections = Object.entries(\n      Array.from(priv.querySelectorAll('Vertex'))\n        .map(v => this.renderedPosition(v))\n        .reduce((obj, pos) => {\n          const ret = obj;\n          const key = JSON.stringify(pos);\n          if (ret[key]) ret[key].count += 1;\n          else ret[key] = { val: pos, count: 1 };\n          return ret;\n        }, {} as Record<string, { val: Point; count: number }>)\n    )\n      .filter(([_, { count }]) => count > 2)\n      .map(([_, { val }]) => val);\n    intersections.forEach(([x, y]) =>\n      circles.push(svg`<circle fill=\"black\" cx=\"${x}\" cy=\"${y}\" r=\"0.15\" />`)\n    );\n    const lines = [] as TemplateResult<2>[];\n    const sections = Array.from(priv.getElementsByTagNameNS(sldNs, 'Section'));\n    const bay = cNode.closest('Bay');\n    const targetSize = this.connecting ? 0.99 : 0.7;\n    const pointerEvents =\n      !this.resizing || isBusBar(this.resizing) ? 'all' : 'none';\n    sections.forEach(section => {\n      const busBar = xmlBoolean(section.getAttribute('bus'));\n      const vertices = Array.from(\n        section.getElementsByTagNameNS(sldNs, 'Vertex')\n      ).map(vertex => this.renderedPosition(vertex));\n      let i = 0;\n      while (i < vertices.length - 1) {\n        const [x1, y1] = vertices[i];\n        let [x2, y2] = vertices[i + 1];\n        let handleClick: (() => void) | symbol = nothing;\n        let handleAuxClick: ((e: MouseEvent) => void) | symbol = nothing;\n        let handleContextMenu: ((e: MouseEvent) => void) | symbol = nothing;\n        if (busBar && bay) {\n          handleClick = () => this.dispatchEvent(newStartPlaceEvent(bay));\n          handleAuxClick = ({ button }: MouseEvent) => {\n            if (button === 1) this.dispatchEvent(newStartResizeEvent(bay));\n          };\n          handleContextMenu = (e: MouseEvent) => this.openMenu(bay, e);\n        }\n        if (busBar && this.resizing === bay) {\n          if (section !== sections.find(s => xmlBoolean(s.getAttribute('bus'))))\n            return;\n          circles.length = 0;\n          const {\n            pos: [vX, vY],\n            dim: [vW, vH],\n          } = attributes(bay.parentElement!);\n          const maxX = vX + vW - 0.5;\n          const maxY = vY + vH - 0.5;\n          if (i === 0) {\n            const dx = Math.max(this.mouseX - x1, 0);\n            const dy = Math.max(this.mouseY - y1, 0);\n            if (dx > dy) {\n              x2 = Math.max(x1, Math.min(maxX, this.mouseX + 0.5));\n              y2 = y1;\n            } else {\n              y2 = Math.max(y1, Math.min(maxY, this.mouseY + 0.5));\n              x2 = x1;\n            }\n            if (x1 === x2 && y1 === y2)\n              if (x2 >= maxX) y2 += 1;\n              else x2 += 1;\n          }\n          handleClick = () => {\n            this.dispatchEvent(\n              newPlaceEvent({\n                parent: section,\n                element: section.getElementsByTagNameNS(sldNs, 'Vertex')[\n                  vertices.length - 1\n                ],\n                x: x2,\n                y: y2,\n              })\n            );\n          };\n          lines.push(svg`<rect x=\"${this.mouseX}\" y=\"${this.mouseY}\"\n              width=\"1\" height=\"1\" fill=\"none\" pointer-events=\"${pointerEvents}\"\n              @click=${handleClick} />`);\n        }\n        if (this.connecting)\n          handleClick = () => {\n            const { equipment, path, terminal } = this.connecting!;\n            if (\n              equipment.querySelector(\n                `Terminal[connectivityNode=\"${cNode.getAttribute('pathName')}\"]`\n              )\n            )\n              return;\n            const [[oldX1, _y], [oldX2, oldY2]] = path.slice(-2);\n            const vertical = oldX1 === oldX2;\n\n            const x3 = this.mouseX + 0.5;\n            const y3 = this.mouseY + 0.5;\n\n            const newX2 = vertical ? oldX2 : x3;\n            const newY2 = vertical ? y3 : oldY2;\n\n            path[path.length - 1] = [newX2, newY2];\n            path.push([x3, y3]);\n            cleanPath(path);\n            this.dispatchEvent(\n              newConnectEvent({\n                equipment,\n                terminal,\n                path,\n                connectTo: cNode,\n              })\n            );\n          };\n\n        lines.push(\n          svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                pointer-events=\"${pointerEvents}\"\n                stroke-width=\"${busBar ? 0.12 : nothing}\" stroke=\"black\" \n                stroke-linecap=\"${busBar ? 'round' : 'square'}\" />`\n        );\n        lines.push(\n          svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                pointer-events=\"${pointerEvents}\" stroke-width=\"${targetSize}\"\n                @contextmenu=${handleContextMenu} @mousedown=${preventDefault}\n                @click=${handleClick} @auxclick=${handleAuxClick} />`\n        );\n        if (\n          busBar ||\n          (this.connecting && ![x1, y1].find(n => Number.isInteger(n)))\n        )\n          lines.push(\n            svg`<rect x=\"${x1 - targetSize / 2}\" y=\"${y1 - targetSize / 2}\"\n                  width=\"${targetSize}\" height=\"${targetSize}\"\n                  @click=${handleClick} @auxclick=${handleAuxClick}\n                  @contextmenu=${handleContextMenu} @mousedown=${preventDefault}\n                  pointer-events=\"${pointerEvents}\" fill=\"none\" />`\n          );\n        if (\n          busBar ||\n          (this.connecting && ![x2, y2].find(n => Number.isInteger(n)))\n        )\n          lines.push(\n            svg`<rect x=\"${x2 - targetSize / 2}\" y=\"${y2 - targetSize / 2}\"\n                  width=\"${targetSize}\" height=\"${targetSize}\"\n                  @click=${handleClick} @auxclick=${handleAuxClick}\n                  @contextmenu=${handleContextMenu} @mousedown=${preventDefault}\n                  pointer-events=\"${pointerEvents}\" fill=\"none\" />`\n          );\n        i += 1;\n      }\n    });\n    const id =\n      cNode.closest('Substation') === this.substation\n        ? identity(cNode)\n        : nothing;\n    return svg`<g class=\"node\" id=\"${id}\" >\n        <title>${cNode.getAttribute('pathName')}</title>\n        ${circles}\n        ${lines}\n      </g>`;\n  }\n\n  static styles = css`\n    h2 {\n      font-family: Roboto;\n      font-weight: 300;\n      font-size: 24px;\n      margin-bottom: 4px;\n      --mdc-icon-button-size: 28px;\n      --mdc-icon-size: 24px;\n    }\n\n    .hidden {\n      display: none;\n    }\n    svg:not(:hover) ~ .coordinates {\n      display: none;\n    }\n    .coordinates {\n      position: fixed;\n      pointer-events: none;\n      font-size: 16px;\n      font-family: 'Roboto', sans-serif;\n      padding: 8px;\n      border-radius: 16px;\n      background: #fffd;\n      color: rgb(0, 0, 0 / 0.83);\n    }\n    .coordinates.invalid {\n      color: #bb1326;\n    }\n\n    * {\n      user-select: none;\n    }\n  `;\n}\n"]}