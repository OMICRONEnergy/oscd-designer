{"version":3,"file":"oscd-designer-nogrid.js","sourceRoot":"","sources":["../oscd-designer-nogrid.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable lit-a11y/click-events-have-key-events */\n/* eslint-disable class-methods-use-this */\n/* eslint-disable no-alert */\n/* eslint-disable no-return-assign */\n/* eslint-disable no-debugger */\n/* eslint-disable no-plusplus */\n/* eslint-disable no-param-reassign */\n\nimport { LitElement, html, css, svg, nothing } from 'lit';\nimport { svg as staticSvg, unsafeStatic } from 'lit/static-html.js';\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars */\nimport { query, state } from 'lit/decorators.js';\n\nimport { Edit, newEditEvent } from '@openscd/open-scd-core';\nimport { getReference, identity } from '@openscd/oscd-scl';\n\nimport { symbols } from './icons.js';\n\n/*\n// open-scd editor action for backwards compatibility\nfunction newCreateEvent(parent: Node, element: Node, reference?: Node | null) {\n  return new CustomEvent('editor-action', {\n    bubbles: true,\n    composed: true,\n    detail: { action: { new: { parent, element, reference } } },\n  });\n}\n*/\n\nconst svgNs = 'http://www.w3.org/2000/svg';\nconst sldNs = 'https://transpower.com/SCL/SSD/SLD/v0';\nconst gridSize = 25;\n\nconst dirs = ['E', 'S', 'W', 'N'] as const;\n\ntype Dir = (typeof dirs)[number];\n\nconst clockwise: Record<Dir, Dir> = { E: 'S', S: 'W', W: 'N', N: 'E' };\n\ntype Attrs = {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n  dir: Dir;\n  bus: boolean;\n};\n\nfunction direction(str: string | null): Dir {\n  const dir = str?.toUpperCase();\n  if (dirs.includes(dir as Dir)) return dir as Dir;\n  return 'S';\n}\n\nconst degrees = { S: 0, W: 90, N: 180, E: 270 };\n\nfunction attributes(element: Element): Attrs {\n  const [x, y, w, h] = ['x', 'y', 'w', 'h'].map(name =>\n    parseInt(element.getAttributeNS(sldNs, name) ?? '1', 10)\n  );\n  const dir = direction(element.getAttributeNS(sldNs, 'dir'));\n  const bus = ['true', '1'].includes(\n    element.getAttributeNS(sldNs, 'bus')?.trim() ?? 'false'\n  );\n\n  return { x, y, w, h, bus, dir };\n}\n\nconst childTags: Partial<Record<string, string[]>> = {\n  SCL: ['Substation'],\n  Substation: ['VoltageLevel'],\n  VoltageLevel: ['Bay'],\n  Bay: ['ConductingEquipment', 'ConnectivityNode'],\n  ConductingEquipment: ['Terminal'],\n};\n\nfunction getChildren(element: Element): Element[] {\n  return Array.from(element.children).filter(child =>\n    childTags[element.tagName]?.includes(child.tagName)\n  );\n}\n\nfunction isValidTarget(target: Element, moving: Element) {\n  return (\n    childTags[target.tagName]?.includes(moving.tagName) &&\n    [target, null].includes(moving.closest(target.tagName))\n  );\n}\n\nfunction svgCoordinates(\n  clientX: number,\n  clientY: number,\n  svgElement: SVGGraphicsElement\n) {\n  const p = new DOMPoint(clientX, clientY);\n  const { x, y } = p.matrixTransform(svgElement.getScreenCTM()?.inverse());\n  return { clickedX: Math.floor(x), clickedY: Math.floor(y) };\n}\n\nfunction connectionPoint(terminal: Element): [number, number] {\n  const equipment = terminal.closest('ConductingEquipment');\n  if (!equipment) return [NaN, NaN];\n  const { x, y, dir } = attributes(equipment);\n  const input =\n    Array.from(equipment.children)\n      .filter(c => c.tagName === 'Terminal')\n      .findIndex(t => t === terminal) === 0;\n  const connectionPoints: Record<Dir, [number, number]> = {\n    S: [x + 0.5, input ? y : y + 1],\n    N: [x + 0.5, input ? y + 1 : y],\n    E: [input ? x : x + 1, y + 0.5],\n    W: [input ? x + 1 : x, y + 0.5],\n  };\n\n  return connectionPoints[dir];\n}\n\ntype LineSegment = {\n  x1: number;\n  y1: number;\n  x2: number;\n  y2: number;\n  from: Element;\n  to?: Element | number;\n};\n\nexport default class Designer extends LitElement {\n  @state()\n  doc?: XMLDocument;\n\n  @state()\n  editCount = -1;\n\n  @state()\n  placing?: Element;\n\n  @state()\n  resizing?: Element;\n\n  getSVG(id: string | number) {\n    if (Number.isNaN(id)) return null;\n    return (\n      this.shadowRoot?.querySelector<SVGGraphicsElement>(`svg#${id}`) ?? null\n    );\n  }\n\n  insertAt(x: number, y: number, parent: Element) {\n    if (!this.placing) return;\n    this.placing.setAttributeNS(sldNs, 'x', x.toString());\n    this.placing.setAttributeNS(sldNs, 'y', y.toString());\n\n    this.dispatchEvent(\n      newEditEvent({\n        parent,\n        node: this.placing,\n        reference: getReference(parent, this.placing.tagName),\n      })\n    );\n  }\n\n  placeAt(clientX: number, clientY: number, target: Element) {\n    if (!this.placing) return;\n    const svgElement = this.getSVG(identity(target.closest('Substation')!));\n    if (!svgElement) return;\n\n    const { clickedX, clickedY } = svgCoordinates(clientX, clientY, svgElement);\n\n    if (this.placing.closest(target.tagName) === target)\n      this.dispatchEvent(\n        newEditEvent({\n          element: this.placing,\n          attributes: {\n            x: { namespaceURI: sldNs, value: clickedX.toString() },\n            y: { namespaceURI: sldNs, value: clickedY.toString() },\n          },\n        })\n      );\n    else this.insertAt(clickedX, clickedY, target);\n\n    if (\n      !['ConductingEquipment', 'Substation', 'ConnectivityNode'].includes(\n        this.placing.tagName\n      )\n    )\n      this.resizing = this.placing;\n    this.placing = undefined;\n  }\n\n  rotateEquipment(element: Element) {\n    const { dir } = attributes(element);\n    const value = clockwise[dir];\n    this.dispatchEvent(\n      newEditEvent({\n        element,\n        attributes: { dir: { namespaceURI: sldNs, value } },\n      })\n    );\n  }\n\n  resizeTo(clientX: number, clientY: number) {\n    if (!this.resizing) return;\n    const svgElement = this.getSVG(\n      identity(this.resizing.closest('Substation')!)\n    );\n    if (!svgElement) return;\n\n    const { clickedX, clickedY } = svgCoordinates(clientX, clientY, svgElement);\n\n    const { x: elementX, y: elementY } = attributes(this.resizing);\n\n    const w = Math.max(clickedX - elementX + 1, 1).toString();\n    const h = Math.max(clickedY - elementY + 1, 1).toString();\n\n    this.dispatchEvent(\n      newEditEvent({\n        element: this.resizing,\n        attributes: {\n          w: { namespaceURI: sldNs, value: w.toString() },\n          h: { namespaceURI: sldNs, value: h.toString() },\n        },\n      })\n    );\n\n    this.resizing = undefined;\n  }\n\n  @state()\n  lineStart?: { x1: number; y1: number; from: Element };\n\n  @state()\n  currentLine: LineSegment[] = [];\n\n  equipmentAt(x: number, y: number, substation: Element): Element | undefined {\n    const eq = Array.from(\n      substation.querySelectorAll(\n        `:scope > VoltageLevel > Bay > ConductingEquipment`\n      )\n    ).find(\n      e =>\n        e.getAttributeNS(sldNs, 'x') === x.toString() &&\n        e.getAttributeNS(sldNs, 'y') === y.toString()\n    );\n    return eq;\n  }\n\n  lineTo(clientX: number, clientY: number) {\n    if (!this.lineStart) return;\n\n    const svgElement = this.getSVG(\n      identity(this.lineStart.from.closest('Substation'))\n    );\n    if (!svgElement) return;\n\n    const { clickedX, clickedY } = svgCoordinates(clientX, clientY, svgElement);\n\n    const x = clickedX + 0.5;\n    const y = clickedY + 0.5;\n\n    this.currentLine.push({ ...this.lineStart, x2: x, y2: y });\n\n    this.lineStart = { ...this.lineStart, x1: x, y1: y };\n  }\n\n  connectNodeAt(clientX: number, clientY: number, cNode: Element) {\n    if (!this.lineStart) return;\n\n    const svgElement = this.getSVG(identity(cNode.closest('Substation')));\n    if (!svgElement) return;\n\n    const { clickedX, clickedY } = svgCoordinates(clientX, clientY, svgElement);\n    const x2 = clickedX + 0.5;\n    const y2 = clickedY + 0.5;\n\n    const content = cNode.querySelector('Private[type=\"Transpower-SLD-v0\"]');\n    let nodeIndex = 1;\n    while (\n      content?.querySelector(`circle[id=\"${identity(cNode)}$node${nodeIndex}\"]`)\n    )\n      nodeIndex++;\n\n    this.currentLine.push({ ...this.lineStart, x2, y2 });\n    this.currentLine.forEach(segment => (segment.to = nodeIndex));\n    this.connectToConnectivityNode(cNode);\n  }\n\n  connectToConnectivityNode(cNode: Element) {\n    const edits: Edit[] = [];\n    const parent = cNode.querySelector('Private[type=\"Transpower-SLD-v0\"]');\n    if (!parent) return;\n    this.currentLine.forEach(({ x1, y1, x2, y2, from, to }) => {\n      const fromId = `${identity(\n        from.parentElement\n      ).toString()}/${from.getAttribute('name')}`;\n      const toId = `${identity(cNode)}$node${to as number}`;\n      const node = this.doc!.createElement('line');\n      node.setAttribute('x1', x1.toString());\n      node.setAttribute('y1', y1.toString());\n      node.setAttribute('x2', x2.toString());\n      node.setAttribute('y2', y2.toString());\n      node.setAttributeNS(sldNs, 'from', fromId);\n      node.setAttributeNS(sldNs, 'to', toId);\n      const clickTarget = node.cloneNode() as Element;\n      clickTarget.setAttribute('stroke', 'transparent');\n      clickTarget.setAttribute('stroke-width', '.6');\n      node.setAttribute('stroke', 'black');\n      node.setAttribute('stroke-width', '0.06');\n      edits.push({ parent, node, reference: null });\n      edits.push({ parent, node: clickTarget, reference: null });\n    });\n    const { x2, y2, from, to } = this.currentLine[this.currentLine.length - 1];\n    const node = this.doc!.createElement('circle');\n    node.setAttribute('cx', x2.toString());\n    node.setAttribute('cy', y2.toString());\n    node.setAttribute('r', '0.1');\n    node.setAttribute('id', `${identity(cNode)}$node${to}`);\n    edits.push({ parent, node, reference: null });\n    edits.push({\n      element: from,\n      attributes: { connectivityNode: cNode.getAttribute('pathName') },\n    });\n\n    this.dispatchEvent(newEditEvent(edits));\n\n    this.reset();\n  }\n\n  connectTerminal(terminal: Element) {\n    const [x, y] = connectionPoint(terminal);\n    if (!this.lineStart) {\n      this.lineStart = { x1: x, y1: y, from: terminal };\n      return;\n    }\n\n    this.currentLine.push({ ...this.lineStart, x2: x, y2: y });\n    this.currentLine.forEach(segment => (segment.to = terminal));\n    this.createConnectivityNode();\n  }\n\n  createConnectivityNode() {\n    if (!this.doc || !this.lineStart) return;\n    const edits: Edit[] = [];\n    const { from: terminal } = this.lineStart;\n\n    const parent = terminal.closest('Bay')!;\n    const nodeNames = Array.from(\n      parent.querySelectorAll(':scope > ConnectivityNode')\n    ).map(node => node.getAttribute('name'));\n    let nodeIndex = 1;\n    while (nodeNames.includes(`L${nodeIndex}`)) nodeIndex++;\n    const name = `L${nodeIndex}`;\n\n    const path = ['Substation', 'VoltageLevel', 'Bay']\n      .map(tag => terminal.closest(tag)?.getAttribute('name'))\n      .join('/');\n    const pathName = `${path}/${name}`;\n\n    const node = this.doc.createElement('ConnectivityNode');\n    node.setAttribute('name', name);\n    node.setAttribute('pathName', pathName);\n\n    [\n      terminal,\n      this.currentLine[this.currentLine.length - 1].to as Element,\n    ].forEach(element =>\n      edits.push({ element, attributes: { connectivityNode: pathName } })\n    );\n\n    const priv = this.doc.createElement('Private');\n    priv.setAttribute('type', 'Transpower-SLD-v0');\n    priv.setAttribute('xmlns', svgNs);\n    priv.setAttribute('xmlns:esld', sldNs);\n    this.currentLine.forEach(({ x1, y1, x2, y2, from, to }, segment) => {\n      const fromId = `${identity(\n        from.parentElement\n      ).toString()}/${from.getAttribute('name')}`;\n      const toId = `${identity((to as Element).parentElement).toString()}/${(\n        to as Element\n      ).getAttribute('name')}`;\n      const line = this.doc!.createElement('line');\n      line.setAttribute('x1', x1.toString());\n      line.setAttribute('y1', y1.toString());\n      line.setAttribute('x2', x2.toString());\n      line.setAttribute('y2', y2.toString());\n      line.setAttributeNS(sldNs, 'segment', segment.toString());\n      line.setAttributeNS(sldNs, 'from', fromId);\n      line.setAttributeNS(sldNs, 'to', toId);\n      const clickTarget = line.cloneNode() as Element;\n      clickTarget.setAttribute('stroke', 'transparent');\n      clickTarget.setAttribute('stroke-width', '0.6');\n      line.setAttribute('stroke', 'black');\n      line.setAttribute('stroke-width', '0.06');\n      priv.appendChild(line);\n      priv.appendChild(clickTarget);\n    });\n    node.appendChild(priv);\n\n    const reference = getReference(parent, 'ConnectivityNode');\n    edits.push({ parent, node, reference });\n\n    this.dispatchEvent(newEditEvent(edits));\n\n    this.reset();\n  }\n\n  renderEquipment(equipment: Element) {\n    const { x, y, dir } = attributes(equipment);\n    const [input, output] = Array.from(equipment.children ?? []).filter(\n      child => child.tagName === 'Terminal'\n    );\n    const deg = degrees[dir];\n\n    const inGrounded =\n      input?.getAttribute('cNodeName') === 'grounded'\n        ? svg`<line x1=\"0.5\" y1=\"-0.1\" x2=\"0.5\" y2=\"0\" stroke=\"black\" stroke-width=\"0.06\" marker-start=\"url(#grounded)\" />`\n        : nothing;\n    const outGrounded =\n      output?.getAttribute('cNodeName') === 'grounded'\n        ? svg`<line x1=\"0.5\" y1=\"1.1\" x2=\"0.5\" y2=\"1\" stroke=\"black\" stroke-width=\"0.06\" marker-start=\"url(#grounded)\" />`\n        : nothing;\n\n    const inOpen =\n      input\n        ?.closest('Substation')\n        ?.querySelector(\n          `ConnectivityNode[pathName=\"${input.getAttribute(\n            'connectivityNode'\n          )}\"] > Private[type=\"Transpower-SLD-v0\"]`\n        ) ||\n      !input ||\n      this.lineStart?.from === input ||\n      inGrounded !== nothing\n        ? nothing\n        : svg`<circle cx=\"0.5\" cy=\"0\" r=\"0.2\" opacity=\"0.4\" fill=\"green\" stroke=\"lightgreen\" @click=${() =>\n            this.connectTerminal(input)} />`;\n\n    const outOpen =\n      output\n        ?.closest('Substation')\n        ?.querySelector(\n          `ConnectivityNode[pathName=\"${output.getAttribute(\n            'connectivityNode'\n          )}\"] > Private[type=\"Transpower-SLD-v0\"]`\n        ) ||\n      !output ||\n      this.lineStart?.from === output ||\n      outGrounded !== nothing\n        ? nothing\n        : svg`<circle cx=\"0.5\" cy=\"1\" r=\"0.2\" opacity=\"0.4\" fill=\"green\" stroke=\"lightgreen\" @click=${() =>\n            this.connectTerminal(output)} />`;\n\n    const eqType = equipment.getAttribute('type') ?? '';\n    const id = ['CBR', 'CTR', 'VTR', 'DIS', 'IFL'].includes(eqType)\n      ? eqType\n      : 'ConductingEquipment';\n\n    return svg`<g class=\"equipment\" transform=\"translate(${x} ${y}) rotate(${deg}, 0.5, 0.5)\">\n      ${inGrounded}\n      ${outGrounded}\n      <title>${equipment.getAttribute('name')}</title>\n      <use href=\"#${id}\" />\n      <rect x=\".1\" y=\".1\" width=\".8\" height=\".8\" fill=\"transparent\"\n        @click=${() => (this.placing = equipment)}\n        @contextmenu=${(e: MouseEvent) => {\n          e.preventDefault();\n          this.rotateEquipment(equipment);\n        }}\n        />\n      ${inOpen}\n      ${outOpen}\n    </g>`;\n  }\n\n  renderBus(bus: Element) {\n    let { x, y, w, h } = attributes(bus);\n    if (h === 1) {\n      h = 0.2;\n      y += 0.4;\n    } else if (w === 1) {\n      w = 0.2;\n      x += 0.4;\n    }\n    return svg`<g>\n      <rect\n      x=\"${x}\"\n      y=\"${y}\"\n      width=\"${w}\"\n      height=\"${h}\"\n      opacity=\"0.5\"\n      fill=\"orange\"\n      />\n    </g>`;\n  }\n\n  renderConnectivityNode(cNode: Element) {\n    const content = cNode.querySelector('Private[type=\"Transpower-SLD-v0\"]');\n    if (!content) return nothing;\n    const svgContent = content.innerHTML;\n    return staticSvg`<g class=\"node\" @click=${(e: MouseEvent) =>\n      this.connectNodeAt(e.clientX, e.clientY, cNode)}>\n       ${unsafeStatic(svgContent)}\n      <title>${cNode.getAttribute('pathName')}</title>\n      </g>`;\n  }\n\n  renderBay(bay: Element) {\n    const { x, y, w, h } = attributes(bay);\n\n    const placeTarget =\n      this.placing && isValidTarget(bay, this.placing)\n        ? svg`<rect\n      x=\"${x}\"\n      y=\"${y}\"\n      width=\"${w}\"\n      height=\"${h}\"\n      @click=${(e: MouseEvent) => this.placeAt(e.clientX, e.clientY, bay)}\n      fill=\"url(#dots)\" />`\n        : nothing;\n    return svg`<g>\n      <text x=\"${x + 0.1}\" y=\"${\n      y - 0.2\n    }\" style=\"font: 0.8px sans-serif;\" @click=${() => (this.placing = bay)}>\n        ${bay.getAttribute('name')}\n      </text>\n      <rect\n      x=\"${x}\"\n      y=\"${y}\"\n      width=\"${w}\"\n      height=\"${h}\"\n      fill=\"transparent\" stroke=\"blue\" stroke-dasharray=\".2 .2\" />\n      ${placeTarget}\n    </g>`;\n  }\n\n  renderVoltageLevel(voltageLevel: Element) {\n    const { x, y, w, h } = attributes(voltageLevel);\n    const bays: Element[] = [];\n    const busses: Element[] = [];\n    getChildren(voltageLevel).forEach(child => {\n      const { bus } = attributes(child);\n      if (bus) busses.push(child);\n      else bays.push(child);\n    });\n\n    const placeTarget =\n      this.placing && isValidTarget(voltageLevel, this.placing)\n        ? svg`\n      <rect\n      x=\"${x}\"\n      y=\"${y}\"\n      width=\"${w}\"\n      height=\"${h}\"\n      @click=${(e: MouseEvent) =>\n        this.placeAt(e.clientX, e.clientY, voltageLevel)}\n      fill=\"url(#dots)\" />\n    `\n        : nothing;\n\n    return svg`<g id=\"${identity(voltageLevel)}\">\n      <text @click=${() => (this.placing = voltageLevel)} x=\"${x}.1\" y=\"${\n      y - 0.2\n    }\" style=\"font: 0.9px sans-serif;\">\n        ${voltageLevel.getAttribute('name')}\n      </text>\n      <rect\n      x=\"${x}\"\n      y=\"${y}\"\n      width=\"${w}\"\n      height=\"${h}\"\n      fill=\"transparent\" stroke=\"orange\" />\n      ${bays.map(b => this.renderBay(b))}\n      ${busses.map(b => this.renderBus(b))}\n      ${placeTarget}\n    </g>`;\n  }\n\n  renderSubstation(substation: Element) {\n    const { w, h } = attributes(substation);\n    const placeTarget =\n      this.placing && isValidTarget(substation, this.placing)\n        ? svg`<rect\n      width=\"${w}\"\n      height=\"${h}\"\n      @click=${(e: MouseEvent) =>\n        this.placeAt(e.clientX, e.clientY, substation)}\n      fill=\"url(#dots)\" />`\n        : nothing;\n\n    const resizeTarget = this.resizing\n      ? svg`<rect\n      width=\"${w}\"\n      height=\"${h}\"\n      @click=${(e: MouseEvent) => this.resizeTo(e.clientX, e.clientY)}\n      fill=\"url(#dots)\" />`\n      : nothing;\n\n    const lineTarget = this.lineStart\n      ? svg`<rect\n      width=\"${w}\"\n      height=\"${h}\"\n      @click=${(e: MouseEvent) => this.lineTo(e.clientX, e.clientY)}\n      fill=\"url(#dots)\" />`\n      : nothing;\n\n    return html`<h3>${substation.getAttribute('name')}</h3>\n      <svg\n        id=${identity(substation)}\n        viewBox=\"0 0 ${w} ${h}\"\n        width=\"${w * gridSize}\"\n        height=\"${h * gridSize}\"\n        style=\"margin: 20px;\"\n        stroke-width=\"0.1\"\n        xmlns=\"${svgNs}\"\n      >\n        ${symbols}\n        <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"white\" />\n        ${getChildren(substation).map(vl => this.renderVoltageLevel(vl))}\n        ${placeTarget} ${resizeTarget} ${lineTarget}\n        ${this.currentLine.map(\n          ({ x1, y1, x2, y2 }) =>\n            svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                      stroke=\"black\" stroke-width=\"0.06\" />`\n        )}\n        ${Array.from(\n          substation.querySelectorAll(\n            'VoltageLevel > Bay > ConductingEquipment'\n          )\n        ).map(e => this.renderEquipment(e))}\n        ${Array.from(\n          substation.querySelectorAll('VoltageLevel > Bay > ConnectivityNode')\n        ).map(c => this.renderConnectivityNode(c))}\n      </svg>`;\n  }\n\n  render() {\n    const substations = Array.from(\n      this.doc?.documentElement.children ?? []\n    ).filter(\n      child =>\n        child.tagName === 'Substation' &&\n        Array.from(child.attributes)\n          .map(a => a.value)\n          .includes(sldNs)\n    );\n\n    return html`<menu>\n        <li>\n          <button @click=${() => this.insertSubstation()}>S</button>\n        </li>\n        <li>\n          <button @click=${() => this.placeVoltageLevel()}>V</button>\n        </li>\n        <li>\n          <button @click=${() => this.placeBay()}>B</button>\n        </li>\n        <li>\n          <button @click=${() => this.placeEquipment()}>E</button>\n        </li>\n        <li>\n          <button @click=${() => this.reset()}>X</button>\n        </li>\n      </menu>\n      <main>${substations.map(s => this.renderSubstation(s))}</main>`;\n  }\n\n  reset() {\n    this.placing = undefined;\n    this.resizing = undefined;\n    this.lineStart = undefined;\n    this.currentLine = [];\n  }\n\n  placeEquipment() {\n    if (!this.doc) return;\n    const eqType = prompt('Equipment type', 'CBR');\n    if (!eqType) return;\n    const name = prompt('Equipment name', `${eqType}1`);\n    if (!name) return;\n    const equipment = this.doc.createElement('ConductingEquipment');\n    equipment.setAttribute('type', eqType);\n    equipment.setAttribute('name', name);\n    equipment.setAttributeNS(sldNs, 'esld:w', '8');\n    equipment.setAttributeNS(sldNs, 'esld:h', '8');\n    this.placing = equipment;\n  }\n\n  placeBay() {\n    if (!this.doc) return;\n    const name = prompt('Bay name', 'Bay X');\n    if (!name) return;\n    const bay = this.doc.createElement('Bay');\n    bay.setAttribute('name', name);\n    bay.setAttributeNS(sldNs, 'esld:w', '8');\n    bay.setAttributeNS(sldNs, 'esld:h', '8');\n    this.placing = bay;\n  }\n\n  placeVoltageLevel() {\n    if (!this.doc) return;\n    const name = prompt('Voltage Level name', '220kV');\n    if (!name) return;\n    const voltageLevel = this.doc.createElement('VoltageLevel');\n    voltageLevel.setAttribute('name', name);\n    voltageLevel.setAttributeNS(sldNs, 'esld:w', '10');\n    voltageLevel.setAttributeNS(sldNs, 'esld:h', '10');\n    this.placing = voltageLevel;\n  }\n\n  insertSubstation() {\n    if (!this.doc) return;\n    const name = prompt('Substation name', 'Substation');\n    if (!name) return;\n    const width = parseInt(prompt('width', '50') ?? '50', 10);\n    const height = parseInt(prompt('height', '25') ?? '25', 10);\n    if (!width || !height) return;\n    const substation = this.doc.createElement('Substation');\n    substation.setAttribute('name', name);\n    substation.setAttribute('xmlns:esld', sldNs);\n    substation.setAttributeNS(sldNs, 'esld:w', width.toString());\n    substation.setAttributeNS(sldNs, 'esld:h', height.toString());\n    this.dispatchEvent(\n      newEditEvent({\n        parent: this.doc.documentElement,\n        node: substation,\n        reference: getReference(this.doc.documentElement, 'Substation'),\n      })\n    );\n  }\n\n  firstUpdated() {\n    window.addEventListener(\n      'keydown',\n      (e: KeyboardEvent) => {\n        if (e.key === 'Escape') this.reset();\n      },\n      true\n    );\n  }\n\n  static styles = css`\n    g.equipment:hover g.terminal > circle {\n      stroke: green;\n    }\n    menu {\n      position: fixed;\n      bottom: 20px;\n      left: 20px;\n      list-style-type: none;\n      display: flex;\n      padding: 0;\n      margin: 0;\n      gap: 5px;\n      z-index: 100;\n    }\n  `;\n}\n"]}