{"version":3,"file":"util.js","sourceRoot":"","sources":["../util.ts"],"names":[],"mappings":"AAAA,MAAM,CAAC,MAAM,QAAQ,GAAG,yBAAyB,CAAC;AAClD,MAAM,CAAC,MAAM,KAAK,GAAG,yCAAyC,CAAC;AAC/D,MAAM,CAAC,MAAM,OAAO,GAAG,+BAA+B,CAAC;AACvD,MAAM,CAAC,MAAM,KAAK,GAAG,4BAA4B,CAAC;AAElD,SAAS,UAAU,CAAC,GAAG,IAAc;IACnC,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACxB,CAAC;AAED,MAAM,UAAU,WAAW,CACzB,OAAuB,EACvB,GAAG,IAAc;IAEjB,MAAM,QAAQ,GAAG,EAAE,CAAC;IACpB,IAAI,KAAK,GAAG,OAAO,CAAC;IACpB,OAAO,CAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,aAAa,KAAI,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE;QACzD,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC,MAAM,CAAE,CAAC,CAAC;QAC9C,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC;KAC7B;IACD,OAAO,UAAU,CAAC,GAAG,QAAQ,EAAE,GAAG,IAAI,CAAC,CAAC;AAC1C,CAAC;AAUD,MAAM,UAAU,UAAU,CAAC,OAAgB;;IACzC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,WAClE,OAAA,UAAU,CAAC,MAAA,OAAO,CAAC,cAAc,CAAC,KAAK,EAAE,IAAI,CAAC,mCAAI,GAAG,CAAC,CAAA,EAAA,CACvD,CAAC;IACF,MAAM,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAU,CAAC;IACrD,MAAM,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAU,CAAC;IAErD,MAAM,IAAI,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,QAAQ,CACjC,MAAA,MAAA,OAAO,CAAC,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,0CAAE,IAAI,EAAE,mCAAI,OAAO,CACzD,CAAC;IAEF,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAkB,CAAC;IAEtD,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;AACjC,CAAC;AAED,MAAM,UAAU,qBAAqB,CAAC,SAAkB;IAItD,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EACX,GAAG,GACJ,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC;IAE1B,MAAM,GAAG,GAAG;QACV,KAAK,EAAE;YACL,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,CAAC;YACZ,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;YAChB,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;YAChB,CAAC,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;SACb,CAAC,GAAG,CAAU;QACf,GAAG,EAAE;YACH,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;YAClB,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;YAClB,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;YAClB,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;SACnB,CAAC,GAAG,CAAU;KAChB,CAAC;IACF,MAAM,MAAM,GAAG;QACb,KAAK,EAAE;YACL,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;YAChB,CAAC,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;YACZ,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,CAAC;YACZ,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;SACjB,CAAC,GAAG,CAAU;QACf,GAAG,EAAE;YACH,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;YAClB,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;YAClB,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;YAClB,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;SACnB,CAAC,GAAG,CAAU;KAChB,CAAC;IAEF,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC;AACzB,CAAC;AAQD,MAAM,UAAU,cAAc,CAAC,MAAoB;IACjD,OAAO,IAAI,WAAW,CAAC,iBAAiB,EAAE;QACxC,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;QACd,MAAM;KACP,CAAC,CAAC;AACL,CAAC;AASD,MAAM,UAAU,aAAa,CAAC,MAAmB;IAC/C,OAAO,IAAI,WAAW,CAAC,gBAAgB,EAAE;QACvC,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;QACd,MAAM;KACP,CAAC,CAAC;AACL,CAAC;AAUD,MAAM,UAAU,eAAe,CAAC,MAAqB;IACnD,OAAO,IAAI,WAAW,CAAC,kBAAkB,EAAE;QACzC,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;QACd,MAAM;KACP,CAAC,CAAC;AACL,CAAC;AAED,MAAM,UAAU,cAAc,CAAC,MAAe;IAC5C,OAAO,IAAI,WAAW,CAAC,iBAAiB,EAAE;QACxC,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;QACd,MAAM;KACP,CAAC,CAAC;AACL,CAAC;AACD,MAAM,UAAU,mBAAmB,CAAC,MAAe;IACjD,OAAO,IAAI,WAAW,CAAC,uBAAuB,EAAE;QAC9C,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;QACd,MAAM;KACP,CAAC,CAAC;AACL,CAAC;AACD,MAAM,UAAU,kBAAkB,CAAC,MAAe;IAChD,OAAO,IAAI,WAAW,CAAC,sBAAsB,EAAE;QAC7C,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;QACd,MAAM;KACP,CAAC,CAAC;AACL,CAAC;AAMD,MAAM,UAAU,oBAAoB,CAClC,MAA0B;IAE1B,OAAO,IAAI,WAAW,CAAC,wBAAwB,EAAE;QAC/C,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;QACd,MAAM;KACP,CAAC,CAAC;AACL,CAAC","sourcesContent":["export const privType = 'Transpower-SLD-Vertices';\nexport const sldNs = 'https://transpower.co.nz/SCL/SSD/SLD/v0';\nexport const xmlnsNs = 'http://www.w3.org/2000/xmlns/';\nexport const svgNs = 'http://www.w3.org/2000/svg';\n\nfunction pathString(...args: string[]) {\n  return args.join('/');\n}\n\nexport function elementPath(\n  element: Element | null,\n  ...rest: string[]\n): string {\n  const pedigree = [];\n  let child = element;\n  while (child?.parentElement && child.hasAttribute('name')) {\n    pedigree.unshift(child.getAttribute('name')!);\n    child = child.parentElement;\n  }\n  return pathString(...pedigree, ...rest);\n}\n\nexport type Point = [number, number];\nexport type Attrs = {\n  pos: Point;\n  dim: Point;\n  flip: boolean;\n  rot: 0 | 1 | 2 | 3;\n};\n\nexport function attributes(element: Element): Attrs {\n  const [x, y, w, h, rotVal] = ['x', 'y', 'w', 'h', 'rot'].map(name =>\n    parseFloat(element.getAttributeNS(sldNs, name) ?? '0')\n  );\n  const pos = [x, y].map(d => Math.max(0, d)) as Point;\n  const dim = [w, h].map(d => Math.max(1, d)) as Point;\n\n  const flip = ['true', '1'].includes(\n    element.getAttributeNS(sldNs, 'flip')?.trim() ?? 'false'\n  );\n\n  const rot = (((rotVal % 4) + 4) % 4) as 0 | 1 | 2 | 3;\n\n  return { pos, dim, flip, rot };\n}\n\nexport function connectionStartPoints(equipment: Element): {\n  top: { close: Point; far: Point };\n  bottom: { close: Point; far: Point };\n} {\n  const {\n    pos: [x, y],\n    rot,\n  } = attributes(equipment);\n\n  const top = {\n    close: [\n      [x + 0.5, y],\n      [x + 1, y + 0.5],\n      [x + 0.5, y + 1],\n      [x, y + 0.5],\n    ][rot] as Point,\n    far: [\n      [x + 0.5, y - 0.5],\n      [x + 1.5, y + 0.5],\n      [x + 0.5, y + 1.5],\n      [x - 0.5, y + 0.5],\n    ][rot] as Point,\n  };\n  const bottom = {\n    close: [\n      [x + 0.5, y + 1],\n      [x, y + 0.5],\n      [x + 0.5, y],\n      [x + 1, y + 0.5],\n    ][rot] as Point,\n    far: [\n      [x + 0.5, y + 1.5],\n      [x - 0.5, y + 0.5],\n      [x + 0.5, y - 0.5],\n      [x + 1.5, y + 0.5],\n    ][rot] as Point,\n  };\n\n  return { top, bottom };\n}\n\nexport type ResizeDetail = {\n  w: number;\n  h: number;\n  element: Element;\n};\nexport type ResizeEvent = CustomEvent<ResizeDetail>;\nexport function newResizeEvent(detail: ResizeDetail): ResizeEvent {\n  return new CustomEvent('oscd-sld-resize', {\n    bubbles: true,\n    composed: true,\n    detail,\n  });\n}\n\nexport type PlaceDetail = {\n  x: number;\n  y: number;\n  element: Element;\n  parent: Element;\n};\nexport type PlaceEvent = CustomEvent<PlaceDetail>;\nexport function newPlaceEvent(detail: PlaceDetail): PlaceEvent {\n  return new CustomEvent('oscd-sld-place', {\n    bubbles: true,\n    composed: true,\n    detail,\n  });\n}\n\nexport type ConnectDetail = {\n  equipment: Element;\n  path: Point[];\n  terminal: 'top' | 'bottom';\n  connectTo: Element;\n  toTerminal?: 'top' | 'bottom';\n};\nexport type ConnectEvent = CustomEvent<ConnectDetail>;\nexport function newConnectEvent(detail: ConnectDetail): ConnectEvent {\n  return new CustomEvent('oscd-sld-connect', {\n    bubbles: true,\n    composed: true,\n    detail,\n  });\n}\nexport type StartEvent = CustomEvent<Element>;\nexport function newRotateEvent(detail: Element): StartEvent {\n  return new CustomEvent('oscd-sld-rotate', {\n    bubbles: true,\n    composed: true,\n    detail,\n  });\n}\nexport function newStartResizeEvent(detail: Element): StartEvent {\n  return new CustomEvent('oscd-sld-start-resize', {\n    bubbles: true,\n    composed: true,\n    detail,\n  });\n}\nexport function newStartPlaceEvent(detail: Element): StartEvent {\n  return new CustomEvent('oscd-sld-start-place', {\n    bubbles: true,\n    composed: true,\n    detail,\n  });\n}\nexport type StartConnectDetail = {\n  equipment: Element;\n  terminal: 'top' | 'bottom';\n};\nexport type StartConnectEvent = CustomEvent<StartConnectDetail>;\nexport function newStartConnectEvent(\n  detail: StartConnectDetail\n): StartConnectEvent {\n  return new CustomEvent('oscd-sld-start-connect', {\n    bubbles: true,\n    composed: true,\n    detail,\n  });\n}\n\ndeclare global {\n  interface ElementEventMap {\n    ['oscd-sld-resize']: ResizeEvent;\n    ['oscd-sld-place']: PlaceEvent;\n    ['oscd-sld-connect']: ConnectEvent;\n    ['oscd-sld-rotate']: StartEvent;\n    ['oscd-sld-start-resize']: StartEvent;\n    ['oscd-sld-start-place']: StartEvent;\n    ['oscd-sld-start-connect']: StartConnectEvent;\n  }\n}\n"]}